// -----------------------------------------------------------------
// Coefficients for (Mdag M)^(-1 / 2) and (Mdag M)^(1 / 4)
// Note the relative sign between fractional powers!
// For now simply copy in remez output, switch using Norder
#include "so4_includes.h"
// -----------------------------------------------------------------



// -----------------------------------------------------------------
// (19, 19) approximation for spectral range [1e-10, 250]
// Nroot 1 gives errors 1.839408e-05 and 1.288195e-05
void setup_rhmc19() {
  if (Nroot == 1) {
    // awk '/res_MD/{print("amp2["$2"] =",$3";")}' < remez/out.N1.D19
    ampdeg2 = 1.6167240197756491e-02;
    amp2[0] = 5.5302498023744597e-06;
    amp2[1] = 9.2927181004890184e-06;
    amp2[2] = 1.9377424725283529e-05;
    amp2[3] = 4.2645432075534933e-05;
    amp2[4] = 9.4926972632914752e-05;
    amp2[5] = 2.1179144133864173e-04;
    amp2[6] = 4.7274679517030375e-04;
    amp2[7] = 1.0553322652995896e-03;
    amp2[8] = 2.3559060670190501e-03;
    amp2[9] = 5.2593060142082449e-03;
    amp2[10] = 1.1740853724082841e-02;
    amp2[11] = 2.6210370926542919e-02;
    amp2[12] = 5.8513701765157418e-02;
    amp2[13] = 1.3064606220754268e-01;
    amp2[14] = 2.9188105324525870e-01;
    amp2[15] = 6.5413232124582443e-01;
    amp2[16] = 1.4888961737832287e+00;
    amp2[17] = 3.6638218768913506e+00;
    amp2[18] = 1.3608821003489824e+01;

    // awk '/pole_MD/{print("shift2["$2"] =",$3";")}' < remez/out.N1.D19
    shift2[0] = 1.7008582037713933e-11;
    shift2[1] = 2.3037999645725860e-10;
    shift2[2] = 1.3365486407230934e-09;
    shift2[3] = 6.8578210767831720e-09;
    shift2[4] = 3.4375254437511049e-08;
    shift2[5] = 1.7151096370912450e-07;
    shift2[6] = 8.5493797553130509e-07;
    shift2[7] = 4.2608520185998013e-06;
    shift2[8] = 2.1234501875160327e-05;
    shift2[9] = 1.0582408121957225e-04;
    shift2[10] = 5.2738354450694602e-04;
    shift2[11] = 2.6282699551490158e-03;
    shift2[12] = 1.3098471189472004e-02;
    shift2[13] = 6.5284107473916983e-02;
    shift2[14] = 3.2551792853074502e-01;
    shift2[15] = 1.6264590678269955e+00;
    shift2[16] = 8.2114812563988302e+00;
    shift2[17] = 4.3713275824120288e+01;
    shift2[18] = 3.1404666937238301e+02;

    // awk '/res_GR/{print("amp4["$2"] =",$3";")}' < remez/out.N1.D19
    ampdeg4 = 7.5136751292641595e+00;
    amp4[0] = -9.7368429683636748e-14;
    amp4[1] = -8.5838761726879890e-13;
    amp4[2] = -6.5243057680522569e-12;
    amp4[3] = -4.8697669164675416e-11;
    amp4[4] = -3.6231973514317980e-10;
    amp4[5] = -2.6940413047963360e-09;
    amp4[6] = -2.0029138257767480e-08;
    amp4[7] = -1.4890504155455979e-07;
    amp4[8] = -1.1070172825405262e-06;
    amp4[9] = -8.2299879444243553e-06;
    amp4[10] = -6.1185018438713749e-05;
    amp4[11] = -4.5488003863076792e-04;
    amp4[12] = -3.3820346549673372e-03;
    amp4[13] = -2.5153911806722561e-02;
    amp4[14] = -1.8739644676590603e-01;
    amp4[15] = -1.4078142183843061e+00;
    amp4[16] = -1.1027162778031746e+01;
    amp4[17] = -1.0682944537318281e+02;
    amp4[18] = -3.5471667051424611e+03;

    // awk '/pole_GR/{print("shift4["$2"] =",$3";")}' < remez/out.N1.D19
    shift4[0] = 5.9808208820640158e-11;
    shift4[1] = 4.6483051890752894e-10;
    shift4[2] = 2.5042648152248188e-09;
    shift4[3] = 1.2659916802805647e-08;
    shift4[4] = 6.3208792475010843e-08;
    shift4[5] = 3.1480688377138758e-07;
    shift4[6] = 1.5670909884459272e-06;
    shift4[7] = 7.8001090654248228e-06;
    shift4[8] = 3.8823833189566105e-05;
    shift4[9] = 1.9323887395539737e-04;
    shift4[10] = 9.6181325553595259e-04;
    shift4[11] = 4.7872881853069666e-03;
    shift4[12] = 2.3828759579868058e-02;
    shift4[13] = 1.1862557322439525e-01;
    shift4[14] = 5.9098843298261250e-01;
    shift4[15] = 2.9552465856607419e+00;
    shift4[16] = 1.5055908023535592e+01;
    shift4[17] = 8.4490408822782115e+01;
    shift4[18] = 8.6899402188323427e+02;
  }
  else {
    node0_printf("setup_rhmc: unrecognized Nroot %d\n", Nroot);
    terminate(1);
  }
}
// -----------------------------------------------------------------



// -----------------------------------------------------------------
// (18, 18) approximation for spectral range [1e-9, 500]
// Nroot 1 gives errors 1.836907e-05 and 1.285775e-05
void setup_rhmc18() {
  if (Nroot == 1) {
    // awk '/res_MD/{print("amp2["$2"] =",$3";")}' < remez/out.N1.D18
    ampdeg2 = 1.1430699714941525e-02;
    amp2[0] = 1.7485953236756578e-05;
    amp2[1] = 2.9379630420775883e-05;
    amp2[2] = 6.1256881579475501e-05;
    amp2[3] = 1.3480012401254762e-04;
    amp2[4] = 3.0003234329036954e-04;
    amp2[5] = 6.6934196175796705e-04;
    amp2[6] = 1.4939277306136884e-03;
    amp2[7] = 3.3346603905470749e-03;
    amp2[8] = 7.4435797155586051e-03;
    amp2[9] = 1.6615527988263837e-02;
    amp2[10] = 3.7089328195054963e-02;
    amp2[11] = 8.2793219271925150e-02;
    amp2[12] = 1.8483958287110588e-01;
    amp2[13] = 4.1292030432877269e-01;
    amp2[14] = 9.2531256967069042e-01;
    amp2[15] = 2.1059729466459292e+00;
    amp2[16] = 5.1820001960619404e+00;
    amp2[17] = 1.9247649693971919e+01;

    // awk '/pole_MD/{print("shift2["$2"] =",$3";")}' < remez/out.N1.D18
    shift2[0] = 1.7004616538345133e-10;
    shift2[1] = 2.3030643071462021e-09;
    shift2[2] = 1.3359328829002944e-08;
    shift2[3] = 6.8535239659766143e-08;
    shift2[4] = 3.4347722973275614e-07;
    shift2[5] = 1.7134328335492206e-06;
    shift2[6] = 8.5395048295309048e-06;
    shift2[7] = 4.2551742697479173e-05;
    shift2[8] = 2.1202439242515791e-04;
    shift2[9] = 1.0564558111602772e-03;
    shift2[10] = 5.2640214655559434e-03;
    shift2[11] = 2.6229566510238871e-02;
    shift2[12] = 1.3070759154527181e-01;
    shift2[13] = 6.5161523831271295e-01;
    shift2[14] = 3.2552398597270296e+00;
    shift2[15] = 1.6431867310502621e+01;
    shift2[16] = 8.7460254683433675e+01;
    shift2[17] = 6.2826110314340087e+02;

    // awk '/res_GR/{print("amp4["$2"] =",$3";")}' < remez/out.N1.D18
    ampdeg4 = 8.9360018389101246e+00;
    amp4[0] = -1.7306378748784165e-12;
    amp4[1] = -1.5253137151807944e-11;
    amp4[2] = -1.1589944947074123e-10;
    amp4[3] = -8.6481499977204110e-10;
    amp4[4] = -6.4324163083295248e-09;
    amp4[5] = -4.7813803503473374e-08;
    amp4[6] = -3.5536785765822093e-07;
    amp4[7] = -2.6411443813785119e-06;
    amp4[8] = -1.9629271901641791e-05;
    amp4[9] = -1.4588713225960543e-04;
    amp4[10] = -1.0842654300519017e-03;
    amp4[11] = -8.0590463875513958e-03;
    amp4[12] = -5.9920880763795419e-02;
    amp4[13] = -4.4627422087722257e-01;
    amp4[14] = -3.3516325486712666e+00;
    amp4[15] = -2.6245514324054138e+01;
    amp4[16] = -2.5420846478843438e+02;
    amp4[17] = -8.4399475759838988e+03;

    // awk '/pole_GR/{print("shift4["$2"] =",$3";")}' < remez/out.N1.D18
    shift4[0] = 5.9786854089622821e-10;
    shift4[1] = 4.6459305215628185e-09;
    shift4[2] = 2.5024547479497508e-08;
    shift4[3] = 1.2647791749683416e-07;
    shift4[4] = 6.3132939140519249e-07;
    shift4[5] = 3.1435219163996610e-06;
    shift4[6] = 1.5644439651089390e-05;
    shift4[7] = 7.7850240863412503e-05;
    shift4[8] = 3.8739254153297999e-04;
    shift4[9] = 1.9277083004002771e-03;
    shift4[10] = 9.5925408043591644e-03;
    shift4[11] = 4.7735228497968900e-02;
    shift4[12] = 2.3757976703596412e-01;
    shift4[13] = 1.1833248761847648e+00;
    shift4[14] = 5.9158053326027185e+00;
    shift4[15] = 3.0131904032491054e+01;
    shift4[16] = 1.6905945036795617e+02;
    shift4[17] = 1.7385677914941125e+03;
  }
  else {
    node0_printf("setup_rhmc: unrecognized Nroot %d\n", Nroot);
    terminate(1);
  }
}
// -----------------------------------------------------------------



// -----------------------------------------------------------------
// (17, 17) approximation for spectral range [1e-8, 500]
// Nroot 1 gives errors 1.344046e-05 and 9.402444e-06
void setup_rhmc17() {
  if (Nroot == 1) {
    // awk '/res_MD/{print("amp2["$2"] =",$3";")}' < remez/out.N1.D17
    ampdeg2 = 1.1147371798737100e-02;
    amp2[0] = 5.3722940572685301e-05;
    amp2[1] = 8.8385072480751058e-05;
    amp2[2] = 1.8007340231269867e-04;
    amp2[3] = 3.8794539542209139e-04;
    amp2[4] = 8.4612041500606707e-04;
    amp2[5] = 1.8502137829396362e-03;
    amp2[6] = 4.0480685084372699e-03;
    amp2[7] = 8.8577470397020776e-03;
    amp2[8] = 1.9382492160158894e-02;
    amp2[9] = 4.2413202346146879e-02;
    amp2[10] = 9.2812632978480553e-02;
    amp2[11] = 2.0313318738952396e-01;
    amp2[12] = 4.4491671801114813e-01;
    amp2[13] = 9.7797710754299438e-01;
    amp2[14] = 2.1868748327541017e+00;
    amp2[15] = 5.3125395060272789e+00;
    amp2[16] = 1.9677105020137233e+01;

    // awk '/pole_MD/{print("shift2["$2"] =",$3";")}' < remez/out.N1.D17
    shift2[0] = 1.6130042183256869e-09;
    shift2[1] = 2.1432786036861466e-08;
    shift2[2] = 1.2047405855410658e-07;
    shift2[3] = 5.9557262426526962e-07;
    shift2[4] = 2.8706425840136872e-06;
    shift2[5] = 1.3764277979797591e-05;
    shift2[6] = 6.5925709202639435e-05;
    shift2[7] = 3.1568761745969382e-04;
    shift2[8] = 1.5116111247316733e-03;
    shift2[9] = 7.2380282461060050e-03;
    shift2[10] = 3.4658438313205010e-02;
    shift2[11] = 1.6597498249559348e-01;
    shift2[12] = 7.9522916120383857e-01;
    shift2[13] = 3.8192462317609230e+00;
    shift2[14] = 1.8554468066394989e+01;
    shift2[15] = 9.5370123256473761e+01;
    shift2[16] = 6.6731352332296819e+02;

    // awk '/res_GR/{print("amp4["$2"] =",$3";")}' < remez/out.N1.D17
    ampdeg4 = 9.0494269232624820e+00;
    amp4[0] = -2.8414818252051702e-11;
    amp4[1] = -2.4019260853714093e-10;
    amp4[2] = -1.7395358164726721e-09;
    amp4[3] = -1.2355524981132256e-08;
    amp4[4] = -8.7448459325129812e-08;
    amp4[5] = -6.1848860184139651e-07;
    amp4[6] = -4.3736760924473751e-06;
    amp4[7] = -3.0927752903654763e-05;
    amp4[8] = -2.1870007726193438e-04;
    amp4[9] = -1.5465243973825584e-03;
    amp4[10] = -1.0937097367318850e-02;
    amp4[11] = -7.7379710345894914e-02;
    amp4[12] = -5.4854442303187756e-01;
    amp4[13] = -3.9256485440506355e+00;
    amp4[14] = -2.9402276895258002e+01;
    amp4[15] = -2.7524388588740709e+02;
    amp4[16] = -9.0024603556401817e+03;

    // awk '/pole_GR/{print("shift4["$2"] =",$3";")}' < remez/out.N1.D17
    shift4[0] = 5.6390697956428344e-09;
    shift4[1] = 4.2749125680623754e-08;
    shift4[2] = 2.2251161130347453e-07;
    shift4[3] = 1.0825970001930432e-06;
    shift4[4] = 5.1955188098676434e-06;
    shift4[5] = 2.4863017337093701e-05;
    shift4[6] = 1.1891054670472911e-04;
    shift4[7] = 5.6863429433976604e-04;
    shift4[8] = 2.7191624530224449e-03;
    shift4[9] = 1.3002845195175142e-02;
    shift4[10] = 6.2181019879431115e-02;
    shift4[11] = 2.9741103398251306e-01;
    shift4[12] = 1.4237655020084565e+00;
    shift4[13] = 6.8446425869024274e+00;
    shift4[14] = 3.3581277204051602e+01;
    shift4[15] = 1.8238276883896646e+02;
    shift4[16] = 1.8363089900772914e+03;
  }
  else {
    node0_printf("setup_rhmc: unrecognized Nroot %d\n", Nroot);
    terminate(1);
  }
}
// -----------------------------------------------------------------



// -----------------------------------------------------------------
// Switch between different sets of coefficients
// for (Mdag M)^(-1 / 2) and (Mdag M)^(1 / 4),
// For given spectral range, run with the smallest Norder
// that keeps Remez errors < 2e-5
void setup_rhmc() {
  node0_printf("Using Nroot = %d\n", Nroot);
  node0_printf("RHMC Norder %d for spectral range ", Norder);

  switch(Norder) {
    case 19:
      node0_printf("[1e-10, 250]\n");
      setup_rhmc19();
      break;
    case 18:
      node0_printf("[1e-9, 500]\n");
      setup_rhmc18();
      break;
    case 17:
      node0_printf("[1e-8, 500]\n");
      setup_rhmc17();
      break;
    default:
      node0_printf("setup_rhmc: unrecognized Norder %d\n", Norder);
      terminate(1);
  }

  // Test by zeroing out all amp2 and amp4, optionally setting Norder to 1
//  int i;
//  Norder = 1;
//  for (i = 0; i < Norder; i++) {
//    amp2[i] = 0;
//    amp4[i] = 0;
//  }
//  node0_printf("TEST VERSION: internal Norder %d\n", Norder);
//  ampdeg2 = 0;
//  amp2[0] = 1;
//  shift2[0] = 1e-3;
//  ampdeg4 = 1;
//  amp4[0] = 0;
//  shift4[0] = 1;

#ifdef DEBUG_CHECK
  int i;
  node0_printf("RHMC ampdeg2 %e\n", ampdeg2);
  for (i = 0; i < Norder; i++)
    node0_printf("RHMC params %d amp2 %e shift2 %e\n", i, amp2[i], shift2[i]);

  node0_printf("RHMC ampdeg4 %e\n", ampdeg4);
  for (i = 0; i < Norder; i++)
    node0_printf("RHMC params %d amp4 %e shift4 %e\n", i, amp4[i], shift4[i]);
#endif
}
// -----------------------------------------------------------------
